<h1>Postgres SQL</h1>

<p>PostgreSQL, comúnmente conocido como Postgres, es uno de los sistemas de gestión de bases de datos relacionales más potentes y populares del mundo.</p>

<p>Este sistema de código abierto combina la robustez de SQL con características avanzadas que lo hacen ideal tanto para aplicaciones pequeñas como para sistemas empresariales de gran escala.</p>

<h2>Tipos de datos</h2>

<p>Para poder almacenar y recuperar datos de forma ordenada y eficiente en una base de datos relacional como Postgres los datos se organizan en tablas, donde cada fila es un registro diferente y las columnas separan cada campo de ese registro.</p>

<p>A cada campo se le asigna un tipo de dato en concreto para poder realizar operaciones de forma eficiente con ese dato, y esas operaciones varían dependiendo de si se tienen datos de tipo texto, de tipo numérico, de tipo fecha, etc.</p>

<p>Con datos numéricos podemos hacer todo tipo de operaciones aritméticas e incluso las bases de datos nos proporcionan funcionalidades como las de poder calcular potencias, promedios, medias, redondeos, múltiplos, etc.</p>

<p>Con textos podemos hacer comparaciones, búsquedas, ordenar de forma alfabética, etc.</p>

<p>Con fechas podemos seleccionar datos por rangos, organizarlos por antigüedad, etc.</p>

<h4>Tipos de datos en Postgres</h4>

<table>
	<tbody>
		<tr>
			<th>Tipo</th>
			<th>Descripción</th>
			<th>Ejemplo</th>
		</tr>
		<tr>
			<td>INTEGER</td>
			<td>Número entero de 4 bytes</td>
			<td>42</td>
		</tr>
		<tr>
			<td>BIGINT</td>
			<td>Número entero de 8 bytes</td>
			<td>9223372036854775807</td>
		</tr>
		<tr>
			<td>SERIAL</td>
			<td>Valor numérico autoincremental</td>
			<td>Empieza en 1 y va sumando 1 por cada registro nuevo</td>
		</tr>
		<tr>
			<td>NUMERIC/DECIMAL</td>
			<td>Número decimal con dígitos fijos después del punto</td>
			<td>123.45</td>
		</tr>
		<tr>
			<td>VARCHAR(n)</td>
			<td>Cadena de caracteres corta</td>
			<td>texto corto</td>
		</tr>
		<tr>
			<td>TEXT</td>
			<td>Campo para textos extensos</td>
			<td>Texto Largo: En un lugar de la mancha, de cuyo nombre no quiero
				acordarme…</td>
		</tr>
		<tr>
			<td>ENUM</td>
			<td>Lista de valores para poder seleccionar</td>
			<td>Pagado, No pagado, Pago rechazado</td>
		</tr>
		<tr>
			<td>TIME</td>
			<td>Hora</td>
			<td>13:45:30</td>
		</tr>
		<tr>
			<td>DATE</td>
			<td>Fecha sin hora</td>
			<td>2024-12-18</td>
		</tr>
		<tr>
			<td>TIMESTAMP</td>
			<td>Fecha y hora</td>
			<td>2024-12-18 08:48:00</td>
		</tr>
		<tr>
			<td>BOOLEAN</td>
			<td>Valor verdadero/falso</td>
			<td>true, false</td>
		</tr>
		<tr>
			<td>BYTEA</td>
			<td>Almacena datos en binario</td>
			<td>Puede almacenar imágenes, video, o el contenido de cualquier archivo en
				binario.</td>
		</tr>
		<tr>
			<td>JSON</td>
			<td>Datos en formato JSON</td>
			<td>{&#x27;clave&#x27;: &#x27;valor&#x27;}</td>
		</tr>
	</tbody>
</table>

<h2>Definición de datos</h2>

<p>En las bases de datos SQL existe el Lenguaje de Definición de Datos (DDL), con el cual podemos crear y modificar la estructura de nuestra base de datos, y lo usaremos para crear o eliminar las tablas y columnas donde vivirá nuestra información.</p>

<h3>Crear una Base de Datos</h3>

<p>Para crear una nueva base de datos en nuestro servidor Postgres usaremos el siguiente comando:</p>

<pre><code>CREATE DATABASE nombre_base_datos;</code></pre>

<h3>Crear una Tabla</h3>

<p>Para crear una nueva tabla con sus columnas y tipos de datos también se usa el comando <strong>CREATE</strong>, y se indican los nombres de las estructuras, los tipos de datos y algunas propiedades extras para la tabla o campos.</p>

<pre><code>CREATE TABLE inventory (
	id SERIAL,
	name VARCHAR(100) NOT NULL,
	stock INTEGER NOT NULL DEFAULT 0,
	weight DECIMAL(8,2) NOT NULL DEFAULT 0,
	active BOOLEAN NOT NULL DEFAULT false,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</code></pre>

<p>Entre las propiedades extra que pueden ser asignadas a campos están las propiedades <strong>NOT NULL</strong> para indicar que el campo no se puede quedar sin ser llenado al agregar o modificar registros, la base de datos notificara de error y no permitirá guardar el registro hasta que se asigne un valor valido.</p>
	
<p>También tenemos la propiedad <strong>DEFAULT</strong> que nos permite indicarle un valor que la base de datos guardara por defecto si no se proporciona un valor al agregar nuevos registros.</p>

<h3>Modificar una Tabla</h3>

<p>Para agregar, modificar o eliminar columnas de una tabla existente se usa el comando <strong>ALTER</strong>.</p>

<pre><code>-- Agregar una columna
ALTER TABLE inventory ADD COLUMN description TEXT;

-- Modificar una columna
ALTER TABLE inventory ALTER COLUMN name TYPE VARCHAR(150);

-- Eliminar una columna
ALTER TABLE inventory DROP COLUMN weight;</code></pre>

<h3>Eliminar objectos</h3>

<p>Para eliminar tablas o bases de datos se usa el comando <strong>DROP</strong></p>

<pre><code>-- Eliminar una tabla
DROP TABLE inventory;

-- Eliminar una base de datos
DROP DATABASE nombre_base_datos;</code></pre>

<h3>Vaciar datos de una tabla</h3>

<p>Para eliminar todos los datos de una tabla y dejarla vacía se usa la instrucción <strong>Truncate</strong>, ejemploL:</p>

<pre><code>TRUNCATE TABLE inventory;</code></pre>


<h2>Lectura y Escritura de Datos en Postgres con SQL</h2>

<h3>Operación de Escritura</h3>

<p>Para insertar y almacenar datos en una tabla de PostgreSQL, se utiliza la instrucción <strong>INSERT INTO</strong>. Esta instrucción permite agregar una nueva fila a una tabla específica, ejemplo:</p>

<pre><code>INSERT INTO inventory (name, stock, active)
VALUES ('Pasta dental', 3, true);</code></pre>


<h3>Operaciones de Lectura</h3>

<p>Para recuperar datos de una tabla de PostgreSQL, se utiliza la instrucción <strong>SELECT</strong>. Esta instrucción permite seleccionar una o más columnas de una o más filas en una tabla específica.</p>

<pre><code>SELECT id, name, stock
FROM inventory</code></pre>

<h3>Operaciones de actualización</h3>

<p>Para actualizar datos en una tabla de PostgreSQL, se utiliza la instrucción <strong>UPDATE</strong>. Esta instrucción permite modificar los valores de una o más columnas de una o más filas en una tabla específica, ejemplo:</p>

<pre><code>UPDATE inventory
SET stock = 9
WHERE name = 'Pasta dental';</code></pre>

<h3>Operaciones de Borrado</h3>

<p>Para borrar datos de una tabla de PostgreSQL, se utiliza la instrucción <strong>DELETE</strong>. Esta instrucción permite eliminar una o más filas de una tabla específica, ejemplo: </p>

<pre><code>DELETE FROM inventory
WHERE name = 'Pasta dental';</code></pre>

<h2>Normalización de datos</h2>

<p>Antes de almacenar datos en una base de datos relacional, la información de cada registro único se separa y se manda a diferentes tablas con el objetivo de no tener datos duplicados, a este proceso se le llama <strong>normalización</strong>.</p>

<p>Separar la información por columnas y luego mandar esas columnas a diferentes tablas ayuda a que el almacenamiento sea mas eficiente y hace que la lectura de datos sea más fácil al operar con unidades de datos mas pequeñas.</p>

<p>Existen multiples reglas de diseño de bases de datos para la normalización y se les conoce como <strong>Forma Normal</strong>, dependiendo de los objetivos de la base de datos se pueden aplicar unas u otras reglas y aunque no siempre es necesario aplicarlas todas (ya  que muchas veces convendrá tener campos sin normalizar) se recomienda estudiar estas reglas para poder aplicarlas en lo posible.</p>

<h2>Relacionando tablas</h2>

<p>Las bases de datos relacionales nos permiten realizar consultas sobre mas de una tabla al mismo tiempo, juntando varias de ellas como si se tratase de una sola, permitiendo en una sola operación de lectura obtener registros con campos que proceden de diferentes tablas.</p>

<p>Operar sobre conjuntos de multiples tablas relacionadas entre si es lo que le da el nombre a las bases de datos relacionales, y es el mecanismo inverso a la <strong>normalización</strong>.</p>

<p>Postgres tiene varias formas de relacionar tablas, y a continuación veremos las principales, pero para ello partiremos de un conjunto de datos de prueba:</p>

<table>
	<caption>Tabla de productos</caption>
	<tr>
		<th>Productos</th>
		<th>Atributos</th>
	</tr>
	<tr>
		<td>Camisa</td>
		<td>
			<table>
				<tr>
					<th>Colores:</th>
					<td>Rojo, Verde, Azul</td>
				</tr>
				<tr>
					<th>Tamaños</th>
					<td>S, M, L, XL</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>Short</td>
		<td>
			<table>
				<tr>
					<th>Colores:</th>
					<td>Gris, Negro, Azul</td>
				</tr>
				<tr>
					<th>Tamaños</th>
					<td>M, L, XL</td>
				</tr>
			</table>
		</td>
	</tr>
</table>

<p>Partiendo de esta lista de productos y sus atributos se construyen las siguientes tablas de base de datos:</p>

<table>
	<tr>
		<th>#</th>
		<th>Productos</th>
	</tr>
	<tr>
		<td>1</td>
		<td>Playera</td>
	</tr>
	<tr>
		<td>2</td>
		<td>Suéter</td>
	</tr>
</table>

<table>
	<tr>
		<th>#</th>
		<th>Colores</th>
	</tr>
	<tr>
		<td>1</td>
		<td>Rojo</td>
	</tr>
	<tr>
		<td>2</td>
		<td>Verde</td>
	</tr>
	<tr>
		<td>3</td>
		<td>Azul</td>
	</tr>
	<tr>
		<td>4</td>
		<td>Gris</td>
	</tr>
	<tr>
		<td>5</td>
		<td>Negro</td>
	</tr>
</table>

<table>
	<tr>
		<th>#</th>
		<th>Tamaños</th>
	</tr>
	<tr>
		<td>1</td>
		<td>S</td>
	</tr>
	<tr>
		<td>2</td>
		<td>M</td>
	</tr>
	<tr>
		<td>3</td>
		<td>L</td>
	</tr>
	<tr>
		<td>4</td>
		<td>XL</td>
	</tr>
</table>

<pre><code>--Tabla para productos
create table products(
	product_id serial,
	product_name varchar(100) not null
);

-Tabla para colores
create table colors(
	color_id serial,
	color_name varchar(100) not null
);

-Tabla para tamaños
create table sizes(
	size_id serial,
	size_name varchar(100) not null
);</code></pre>

<p>Usando estas tablas SQL vamos a explicar las relaciones.</p>

<h3>Cross Join</h3>

<p>Relacionar dos tablas cualquiera mediante <strong>CROSS JOIN</strong> nos permite obtener una combinación de ellas, dando como resultado una operación matemática llamada producto cartesiano, las tablas ni siquiera tienen que estar directamente relacionadas.</p>

<pre><code>select color_name, size_name 
from colors
cross join sizes</code></pre>

<h3>Inner Join</h3>

<p>Relacionar tablas mediante INNER JOIN permite devolver solo las filas que tienen coincidencias en ambas tablas.</p>

<h3>Left Join</h3>

<p>Usando la relación de tablas tipo <strong>LEFT JOIN</strong> nos devuelve todas las filas de la tabla de la izquierda, y las filas coincidentes de la tabla de la derecha y si no hay coincidencia, las filas de la tabla de la derecha tendrán valores NULL.</p>

<h3>Right Join</h3>

<p>usar <strong>RIGHT JOIN</strong> para juntar tablas devuelve todas las filas de la tabla de la derecha, y las filas coincidentes de la tabla de la izquierda, si no hay coincidencia, las filas de la tabla de la izquierda tendrán valores NULL.</p>

<h3>Full Join</h3>

<p>Relacionar tablas mediante <strong>FULL JOIN</strong> devuelve todas las filas del conjunto de tablas con el que se esta operando.</p>

<p>Las filas que no tienen coincidencias en cualquiera de las tablas también se verán con valores NULL.</p>